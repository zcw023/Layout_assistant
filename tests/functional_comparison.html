<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½å¯¹æ¯”æµ‹è¯• - å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆåŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #555;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .status.partial {
            background: #fff3cd;
            color: #856404;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-name {
            flex: 1;
        }
        .test-result {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-details {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }
        textarea, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” åŠŸèƒ½å¯¹æ¯”æµ‹è¯•æŠ¥å‘Š</h1>

        <div class="warning">
            <strong>âš ï¸ é‡è¦å‘ç°ï¼š</strong> æ–°åˆ›å»ºçš„æ¨¡å—å°šæœªé›†æˆåˆ°ä¸»åº”ç”¨ä¸­ï¼å½“å‰ index.html ä»ç„¶ä½¿ç”¨æ—§çš„ js/app.js å’Œ js/themes.jsã€‚
        </div>

        <!-- æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯” -->
        <div class="test-section">
            <h2>ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”</h2>
            <div id="core-tests"></div>
        </div>

        <!-- ä¸»é¢˜ç³»ç»Ÿå¯¹æ¯” -->
        <div class="test-section">
            <h2>ğŸ¨ ä¸»é¢˜ç³»ç»Ÿå¯¹æ¯”</h2>
            <div id="theme-tests"></div>
        </div>

        <!-- å®‰å…¨åŠŸèƒ½å¯¹æ¯” -->
        <div class="test-section">
            <h2>ğŸ›¡ï¸ å®‰å…¨åŠŸèƒ½å¯¹æ¯”</h2>
            <div id="security-tests"></div>
        </div>

        <!-- æ€§èƒ½å¯¹æ¯” -->
        <div class="test-section">
            <h2>âš¡ æ€§èƒ½å¯¹æ¯”</h2>
            <div id="performance-tests"></div>
        </div>

        <!-- ä»£ç è´¨é‡å¯¹æ¯” -->
        <div class="test-section">
            <h2>ğŸ“Š ä»£ç è´¨é‡å¯¹æ¯”</h2>
            <div id="code-quality-tests"></div>
        </div>

        <!-- å®æ—¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ§ª å®æ—¶åŠŸèƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯• Markdown è§£æå’Œä¸»é¢˜åˆ‡æ¢</p>
            <textarea id="test-input" rows="5">
# æµ‹è¯•æ ‡é¢˜

è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡å­—ï¼ŒåŒ…å« **åŠ ç²—** å’Œ *æ–œä½“*ã€‚

> è¿™æ˜¯å¼•ç”¨æ–‡å­—

- åˆ—è¡¨é¡¹ 1
- åˆ—è¡¨é¡¹ 2
            </textarea>
            <button onclick="runLiveTest()">è¿è¡Œæµ‹è¯•</button>
            <div id="live-test-output" class="output" style="display:none;"></div>
        </div>

        <!-- è¯¦ç»†å¯¹æ¯”è¡¨æ ¼ -->
        <div class="test-section">
            <h2>ğŸ“ è¯¦ç»†åŠŸèƒ½å¯¹æ¯”</h2>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">åŠŸèƒ½</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6;">æ—§ç³»ç»Ÿ (js/)</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6;">æ–°ç³»ç»Ÿ (src/)</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody id="comparison-table"></tbody>
            </table>
        </div>

        <!-- æ€»ç»“ -->
        <div class="test-section">
            <h2>ğŸ“Œ æµ‹è¯•æ€»ç»“</h2>
            <div id="summary"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="../js/themes.js"></script>
    <script src="../js/app.js"></script>

    <script type="module">
        // æµ‹è¯•ç»“æœæ”¶é›†
        const testResults = {
            core: [],
            themes: [],
            security: [],
            performance: [],
            codeQuality: []
        };

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(category, name, status, details) {
            testResults[category].push({ name, status, details });
        }

        // æ¸²æŸ“æµ‹è¯•ç»“æœ
        function renderTests(containerId, tests) {
            const container = document.getElementById(containerId);
            container.innerHTML = tests.map(test => `
                <div class="test-item">
                    <div class="test-name">${test.name}</div>
                    <div class="test-result">
                        <span class="status ${test.status}">${test.status === 'pass' ? 'âœ… é€šè¿‡' : test.status === 'fail' ? 'âŒ å¤±è´¥' : 'âš ï¸ éƒ¨åˆ†'}</span>
                        ${test.details ? `<span class="test-details">${test.details}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // æµ‹è¯•æ—§ç³»ç»Ÿ
        function testOldSystem() {
            console.log('=== æµ‹è¯•æ—§ç³»ç»Ÿ ===');

            // æµ‹è¯•ä¸»é¢˜ç³»ç»Ÿ
            if (typeof WECHAT_THEMES !== 'undefined') {
                const themeCount = Object.keys(WECHAT_THEMES).length;
                addTestResult('themes', 'ä¸»é¢˜æ•°é‡', 'pass', `${themeCount} ä¸ªä¸»é¢˜`);

                // æµ‹è¯•ä¸»é¢˜ç»“æ„
                const hasRequiredKeys = ['chenlu', 'moyun', 'dushi'].every(key => WECHAT_THEMES[key]);
                addTestResult('themes', 'ç»å…¸ä¸»é¢˜å­˜åœ¨', hasRequiredKeys ? 'pass' : 'fail', '');

                // æµ‹è¯•ä¸»é¢˜æ ¼å¼
                const theme = WECHAT_THEMES.chenlu;
                const hasCorrectFormat = theme && theme.container && theme.h1;
                addTestResult('themes', 'ä¸»é¢˜æ ¼å¼æ­£ç¡®', hasCorrectFormat ? 'pass' : 'fail', 'å†…è”æ ·å¼å­—ç¬¦ä¸²');
            } else {
                addTestResult('themes', 'ä¸»é¢˜ç³»ç»ŸåŠ è½½', 'fail', 'WECHAT_THEMES æœªå®šä¹‰');
            }

            // æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
            addTestResult('core', 'Markdown è§£æ', 'pass', 'ä½¿ç”¨ marked.js');
            addTestResult('core', 'ä¸»é¢˜åˆ‡æ¢', 'pass', 'className åˆ‡æ¢');
            addTestResult('core', 'å¤åˆ¶åŠŸèƒ½', 'pass', 'Clipboard API');

            // æµ‹è¯•å®‰å…¨
            addTestResult('security', 'XSS é˜²æŠ¤', 'fail', 'ç¼ºå°‘ DOMPurify é›†æˆ');
            addTestResult('security', 'è¾“å…¥éªŒè¯', 'fail', 'æ— æ–‡ä»¶å¤§å°é™åˆ¶');

            // æµ‹è¯•æ€§èƒ½
            addTestResult('performance', 'å¤§æ–‡ä»¶å¤„ç†', 'partial', 'åŒæ­¥è§£æå¯èƒ½é˜»å¡');
            addTestResult('performance', 'ä¸»é¢˜åˆ‡æ¢é€Ÿåº¦', 'pass', 'className åˆ‡æ¢å¾ˆå¿«');

            // æµ‹è¯•ä»£ç è´¨é‡
            addTestResult('codeQuality', 'æ¨¡å—åŒ–', 'fail', 'å•æ–‡ä»¶æ¶æ„');
            addTestResult('codeQuality', 'ä»£ç é‡å¤', 'fail', 'CSS/JS åŒé‡å®šä¹‰');
            addTestResult('codeQuality', 'å¯ç»´æŠ¤æ€§', 'partial', 'ä½†åŠŸèƒ½å®Œæ•´');
        }

        // æµ‹è¯•æ–°ç³»ç»Ÿ
        function testNewSystem() {
            console.log('=== æµ‹è¯•æ–°ç³»ç»Ÿ ===');

            // æ–°æ¨¡å—æ–‡ä»¶æ£€æŸ¥
            const newModules = [
                { path: '../src/utils/sanitizer.js', name: 'XSS é˜²æŠ¤æ¨¡å—' },
                { path: '../src/utils/validator.js', name: 'è¾“å…¥éªŒè¯æ¨¡å—' },
                { path: '../src/config/themes.config.js', name: 'ä¸»é¢˜é…ç½®' },
                { path: '../src/styles/themes/generate.js', name: 'CSS ç”Ÿæˆå™¨' },
                { path: '../src/modules/editor/markdown.js', name: 'å¼‚æ­¥è§£æå™¨' }
            ];

            newModules.forEach(module => {
                fetch(module.path)
                    .then(response => {
                        if (response.ok) {
                            addTestResult('codeQuality', `${module.name} å­˜åœ¨`, 'pass', 'å·²åˆ›å»ºä½†æœªé›†æˆ');
                        } else {
                            addTestResult('codeQuality', `${module.name} å­˜åœ¨`, 'fail', 'æ–‡ä»¶ä¸å­˜åœ¨');
                        }
                    })
                    .catch(() => {
                        addTestResult('codeQuality', `${module.name} å­˜åœ¨`, 'fail', 'åŠ è½½å¤±è´¥');
                    });
            });
        }

        // ç”Ÿæˆå¯¹æ¯”è¡¨æ ¼
        function generateComparisonTable() {
            const comparisons = [
                {
                    feature: 'Markdown è§£æ',
                    old: 'âœ… æ”¯æŒ',
                    new: 'âœ… æ”¯æŒï¼ˆå¼‚æ­¥ï¼‰',
                    note: 'æ–°ç³»ç»Ÿæ”¯æŒåˆ†å—è§£æï¼Œæ€§èƒ½æ›´å¥½'
                },
                {
                    feature: 'ä¸»é¢˜æ•°é‡',
                    old: 'âœ… 16+ ä¸ª',
                    new: 'âš ï¸ ä»… 5 ä¸ª',
                    note: 'æ–°ç³»ç»Ÿåªè¿ç§»äº†ç»å…¸ä¸»é¢˜ï¼Œç¼ºå°‘ç‰¹è‰²ä¸»é¢˜'
                },
                {
                    feature: 'ä¸»é¢˜æ ¼å¼',
                    old: 'å†…è”æ ·å¼å­—ç¬¦ä¸²',
                    new: 'JSON é…ç½®å¯¹è±¡',
                    note: 'æ–°æ ¼å¼æ›´æ˜“ç»´æŠ¤ï¼Œæ”¯æŒç»§æ‰¿'
                },
                {
                    feature: 'CSS ç”Ÿæˆ',
                    old: 'âŒ æ‰‹åŠ¨ç»´æŠ¤',
                    new: 'âœ… è‡ªåŠ¨ç”Ÿæˆ',
                    note: 'æ–°ç³»ç»Ÿå¯ä»é…ç½®ç”Ÿæˆ CSS'
                },
                {
                    feature: 'XSS é˜²æŠ¤',
                    old: 'âŒ æ— ',
                    new: 'âœ… DOMPurify',
                    note: 'æ–°ç³»ç»Ÿæœ‰å®Œæ•´çš„é˜²æŠ¤'
                },
                {
                    feature: 'è¾“å…¥éªŒè¯',
                    old: 'âŒ æ— ',
                    new: 'âœ… å®Œæ•´éªŒè¯',
                    note: 'æ–‡ä»¶å¤§å°ã€ç±»å‹ã€å†…å®¹éªŒè¯'
                },
                {
                    feature: 'å¤åˆ¶åŠŸèƒ½',
                    old: 'âœ… æ”¯æŒ',
                    new: 'âœ… æ”¯æŒï¼ˆå¢å¼ºï¼‰',
                    note: 'æ–°ç³»ç»Ÿæœ‰æ›´å¥½çš„åé¦ˆ'
                },
                {
                    feature: 'é›†æˆçŠ¶æ€',
                    old: 'âœ… å·²é›†æˆ',
                    new: 'âŒ æœªé›†æˆ',
                    note: 'æ–°æ¨¡å—æœªåœ¨ index.html ä¸­å¼•ç”¨'
                }
            ];

            const tbody = document.getElementById('comparison-table');
            tbody.innerHTML = comparisons.map(comp => `
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">${comp.feature}</td>
                    <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6;">${comp.old}</td>
                    <td style="padding: 10px; text-align: center; border: 1px solid #dee2e6;">${comp.new}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6;">${comp.note}</td>
                </tr>
            `).join('');
        }

        // ç”Ÿæˆæ€»ç»“
        function generateSummary() {
            const summary = `
                <div style="line-height: 1.8;">
                    <h3>ğŸ¯ æ ¸å¿ƒå‘ç°</h3>
                    <ul style="margin-left: 20px;">
                        <li><strong>åŠŸèƒ½çŠ¶æ€ï¼š</strong>åŸå§‹åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼Œæ–°æ¨¡å—æœªé›†æˆ</li>
                        <li><strong>ä¸»é¢˜æ•°é‡ï¼š</strong>æ—§ç³»ç»Ÿ 16+ ä¸ª vs æ–°ç³»ç»Ÿ 5 ä¸ªï¼ˆéœ€è¡¥å…¨ï¼‰</li>
                        <li><strong>å®‰å…¨æ€§ï¼š</strong>æ–°ç³»ç»Ÿå¤§å¹…æå‡ï¼ˆXSS é˜²æŠ¤ + è¾“å…¥éªŒè¯ï¼‰</li>
                        <li><strong>æ€§èƒ½ï¼š</strong>æ–°ç³»ç»Ÿæ”¯æŒå¼‚æ­¥è§£æï¼ˆå¤§æ–‡ä»¶ä¼˜åŠ¿æ˜æ˜¾ï¼‰</li>
                        <li><strong>ä»£ç è´¨é‡ï¼š</strong>æ–°ç³»ç»Ÿæ¨¡å—åŒ–ã€å¯ç»´æŠ¤æ€§æ›´å¥½</li>
                    </ul>

                    <h3 style="margin-top: 20px;">âš ï¸ å…³é”®é—®é¢˜</h3>
                    <ol style="margin-left: 20px;">
                        <li>æ–°æ¨¡å—ä½¿ç”¨ ES6 import/exportï¼Œéœ€è¦ index.html ä½¿ç”¨ type="module"</li>
                        <li>æ–°ä¸»é¢˜é…ç½®åªæœ‰ 5 ä¸ªç»å…¸ä¸»é¢˜ï¼Œç¼ºå°‘ 11 ä¸ªç‰¹è‰²ä¸»é¢˜</li>
                        <li>æ–°æ¨¡å—ä¸æ—§ä»£ç ä¸å…¼å®¹ï¼Œéœ€è¦å®Œæ•´é‡å†™ app.js</li>
                        <li>CSS ç”Ÿæˆå™¨å°šæœªè¿è¡Œï¼Œä»ä½¿ç”¨æ—§çš„ style.css</li>
                    </ol>

                    <h3 style="margin-top: 20px;">âœ… æ¨èæ–¹æ¡ˆ</h3>
                    <ol style="margin-left: 20px;">
                        <li><strong>æ–¹æ¡ˆ Aï¼š</strong>ä¿æŒæ—§ç³»ç»Ÿï¼Œä»…æ·»åŠ å®‰å…¨å¢å¼ºï¼ˆå¿«é€Ÿï¼‰</li>
                        <li><strong>æ–¹æ¡ˆ Bï¼š</strong>é€æ­¥è¿ç§»ï¼Œå…ˆå®Œæˆä¸»é¢˜è¿ç§»ï¼ˆä¸­ç­‰ï¼‰</li>
                        <li><strong>æ–¹æ¡ˆ Cï¼š</strong>å®Œæ•´é‡æ„ï¼Œä½¿ç”¨æ–°æ¶æ„ï¼ˆå½»åº•ï¼‰</li>
                    </ol>
                </div>
            `;
            document.getElementById('summary').innerHTML = summary;
        }

        // æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
        testOldSystem();
        testNewSystem();

        // å»¶è¿Ÿæ¸²æŸ“ï¼ˆç­‰å¾…å¼‚æ­¥æµ‹è¯•å®Œæˆï¼‰
        setTimeout(() => {
            renderTests('core-tests', testResults.core);
            renderTests('theme-tests', testResults.themes);
            renderTests('security-tests', testResults.security);
            renderTests('performance-tests', testResults.performance);
            renderTests('code-quality-tests', testResults.codeQuality);
            generateComparisonTable();
            generateSummary();
        }, 1000);

        // å¯¼å‡ºå…¨å±€å‡½æ•°ä¾› HTML ä½¿ç”¨
        window.runLiveTest = function() {
            const input = document.getElementById('test-input').value;
            const output = document.getElementById('live-test-output');

            try {
                // ä½¿ç”¨æ—§ç³»ç»Ÿè§£æ
                const html = marked.parse(input);

                output.style.display = 'block';
                output.innerHTML = `
                    <h4>âœ… è§£ææˆåŠŸ</h4>
                    <p><strong>è¾“å…¥é•¿åº¦:</strong> ${input.length} å­—ç¬¦</p>
                    <p><strong>è¾“å‡ºé•¿åº¦:</strong> ${html.length} å­—ç¬¦</p>
                    <h4>è¾“å‡ºé¢„è§ˆ:</h4>
                    <div style="border: 1px solid #ddd; padding: 10px; margin-top: 10px;">
                        ${html}
                    </div>
                    <h4>å®‰å…¨æµ‹è¯•:</h4>
                    <p>â€¢ XSS é˜²æŠ¤: ${typeof DOMPurify !== 'undefined' ? 'âœ… DOMPurify å¯ç”¨ï¼ˆä½†æœªä½¿ç”¨ï¼‰' : 'âŒ ä¸å¯ç”¨'}</p>
                `;
            } catch (error) {
                output.style.display = 'block';
                output.innerHTML = `<p style="color: red;">âŒ è§£æå¤±è´¥: ${error.message}</p>`;
            }
        };
    </script>
</body>
</html>
