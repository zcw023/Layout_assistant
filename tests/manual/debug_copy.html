<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¤åˆ¶è°ƒè¯• - éƒ½å¸‚ä¸»é¢˜</title>
    <script src="js/themes.js?v=2026"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .box { background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #333; }
        textarea { width: 100%; height: 300px; font-family: monospace; font-size: 11px; border: 1px solid #ddd; padding: 10px; }
        .preview-box { border: 2px solid #333; padding: 40px; margin: 20px 0; background: #fff; }
        button { padding: 12px 24px; font-size: 16px; cursor: pointer; background: #000; color: #fff; border: none; margin-right: 10px; }
        button:hover { background: #333; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª éƒ½å¸‚ä¸»é¢˜å¤åˆ¶è°ƒè¯•</h1>
        
        <div class="info">
            <strong>è¯´æ˜ï¼š</strong>è¾“å…¥ Markdown å†…å®¹ï¼Œç‚¹å‡»ç”Ÿæˆï¼ŒæŸ¥çœ‹å³ä¾§é¢„è§ˆå’Œç”Ÿæˆçš„ HTML æºç ã€‚
            å¯¹æ¯”ä¸¤è€…æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœç”Ÿæˆçš„ HTML ä¸­æ²¡æœ‰å†…è” styleï¼Œè¯´æ˜å¤åˆ¶é€»è¾‘æœ‰é—®é¢˜ã€‚
        </div>
        
        <div class="box">
            <h3>1. è¾“å…¥ Markdown</h3>
            <textarea id="input"># æµ‹è¯•æ ‡é¢˜

è¿™æ˜¯æ­£æ–‡ï¼Œ**åŠ ç²—æ–‡å­—**å’Œ*æ–œä½“*ã€‚

> å¼•ç”¨å—

---

å¦ä¸€æ®µ</textarea>
        </div>
        
        <div class="box">
            <h3>2. æ“ä½œ</h3>
            <button onclick="generate()">ç”Ÿæˆ HTMLï¼ˆéƒ½å¸‚ä¸»é¢˜ï¼‰</button>
            <button onclick="copyToClipboard()">å¤åˆ¶ HTML</button>
        </div>
        
        <div class="box">
            <h3>3. é¢„è§ˆæ•ˆæœï¼ˆåº”è¯¥å’Œå¾®ä¿¡ä¸€è‡´ï¼‰</h3>
            <div id="preview-container"></div>
        </div>
        
        <div class="box">
            <h3>4. ç”Ÿæˆçš„ HTML æºç ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ style å±æ€§ï¼‰</h3>
            <textarea id="output" readonly></textarea>
        </div>
    </div>
    
    <script>
        function generate() {
            const input = document.getElementById('input').value;
            
            // Markdown è½¬ HTMLï¼ˆç®€åŒ–ç‰ˆï¼‰
            let html = input
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>')
                .replace(/^---$/gm, '<hr>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(?!<[hbe]|<hr)(.+)$/gm, '<p>$1</p>');
            
            // ä½¿ç”¨ app.js ç›¸åŒçš„é€»è¾‘ç”Ÿæˆæ ·å¼
            const styledHtml = generateStyledHtml(html, 'dushi');
            
            // æ˜¾ç¤ºé¢„è§ˆ
            const previewContainer = document.getElementById('preview-container');
            previewContainer.innerHTML = styledHtml;
            previewContainer.style.cssText = 'border: 2px solid #333; padding: 40px; margin: 20px 0; background: #fff;';
            
            // æ˜¾ç¤ºæºç 
            document.getElementById('output').value = styledHtml;
        }
        
        // ä» app.js å¤åˆ¶çš„é€»è¾‘
        function generateStyledHtml(html, themeName) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const body = doc.body;
            
            const theme = WECHAT_THEMES[themeName];
            
            // åˆ›å»ºåŒ…è£…å®¹å™¨
            const wrapper = document.createElement('div');
            wrapper.setAttribute('style', theme.container);
            
            // å¤„ç†æ¯ä¸ªå­å…ƒç´ 
            Array.from(body.children).forEach(function(child) {
                const styledChild = applyStylesRecursive(child, theme);
                wrapper.appendChild(styledChild);
            });
            
            return wrapper.outerHTML;
        }
        
        function applyStylesRecursive(element, theme) {
            const tagName = element.tagName.toLowerCase();
            
            // å…‹éš†å…ƒç´ 
            const clone = element.cloneNode(false);
            
            // åº”ç”¨å½“å‰å…ƒç´ çš„æ ·å¼
            if (theme[tagName]) {
                clone.setAttribute('style', theme[tagName]);
            }
            
            // ç‰¹æ®Šå¤„ç†å›¾ç‰‡
            if (tagName === 'img') {
                const src = element.getAttribute('src') || '';
                const alt = element.getAttribute('alt') || '';
                clone.setAttribute('src', src);
                clone.setAttribute('alt', alt);
                clone.setAttribute('style', theme.img || 'max-width:100%;height:auto;display:block;margin:20px auto;');
            }
            
            // é€’å½’å¤„ç†å­å…ƒç´ 
            Array.from(element.children).forEach(function(child) {
                const styledChild = applyStylesRecursive(child, theme);
                clone.appendChild(styledChild);
            });
            
            // å¤„ç†æ–‡æœ¬èŠ‚ç‚¹
            if (clone.children.length === 0 && element.textContent) {
                clone.textContent = element.textContent;
            }
            
            return clone;
        }
        
        async function copyToClipboard() {
            const html = document.getElementById('output').value;
            if (!html) {
                alert('å…ˆç”Ÿæˆ HTML');
                return;
            }
            
            try {
                const blob = new Blob([html], { type: 'text/html' });
                await navigator.clipboard.write([
                    new ClipboardItem({ 'text/html': blob })
                ]);
                alert('å·²å¤åˆ¶ï¼è¯·åˆ°å¾®ä¿¡ç¼–è¾‘å™¨ç²˜è´´æŸ¥çœ‹æ•ˆæœ');
            } catch (err) {
                console.error(err);
                alert('å¤åˆ¶å¤±è´¥: ' + err.message);
            }
        }
        
        // åˆå§‹ç”Ÿæˆ
        generate();
    </script>
</body>
</html>
