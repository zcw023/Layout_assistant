<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>浏览器端测试</title>
    <script src="js/themes.js?v=2026"></script>
</head>
<body style="padding: 40px; font-family: sans-serif;">
    <h1>浏览器端复制测试</h1>
    
    <h3>测试内容（Markdown）:</h3>
    <pre id="input" style="background: #f0f0f0; padding: 10px;"># 测试标题

这是正文，**加粗文字**。

> 引用块

---

另一段</pre>
    
    <button onclick="testGenerate()" style="padding: 10px 20px; font-size: 16px; margin: 20px 0;">生成都市主题 HTML</button>
    
    <h3>生成的 HTML:</h3>
    <textarea id="output" style="width: 100%; height: 300px; font-family: monospace; font-size: 11px;"></textarea>
    
    <h3>验证结果:</h3>
    <div id="verify" style="background: #e3f2fd; padding: 15px;"></div>
    
    <script>
        // 模拟 marked.parse
        function mockParse(md) {
            return md
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(?!<[hbs])(.+)$/gm, '<p>$1</p>');
        }
        
        // 使用 app.js 相同的逻辑
        function generateStyledHtml(html, theme) {
            let styledHtml = '<div style="' + theme.container + '">';
            
            const temp = document.createElement('div');
            temp.innerHTML = html;
            
            Array.from(temp.children).forEach(function(el) {
                const tag = el.tagName.toLowerCase();
                const style = theme[tag] || '';
                
                if (tag === 'img') {
                    const src = el.getAttribute('src') || '';
                    const alt = el.getAttribute('alt') || '';
                    styledHtml += '<img src="' + src + '" alt="' + alt + '" style="' + (theme.img || 'max-width:100%;') + '">';
                } else {
                    styledHtml += '<' + tag + (style ? ' style="' + style + '"' : '') + '>';
                    styledHtml += getInnerHtml(el, theme);
                    styledHtml += '</' + tag + '>';
                }
            });
            
            styledHtml += '</div>';
            return styledHtml;
        }
        
        function getInnerHtml(el, theme) {
            let result = '';
            Array.from(el.childNodes).forEach(function(node) {
                if (node.nodeType === 3) {
                    result += node.textContent;
                } else if (node.nodeType === 1) {
                    const tag = node.tagName.toLowerCase();
                    const style = theme[tag] || '';
                    result += '<' + tag + (style ? ' style="' + style + '"' : '') + '>';
                    result += getInnerHtml(node, theme);
                    result += '</' + tag + '>';
                }
            });
            return result;
        }
        
        function testGenerate() {
            const input = document.getElementById('input').textContent;
            const html = mockParse(input);
            const theme = WECHAT_THEMES.dushi;
            
            console.log('主题:', theme);
            console.log('h1:', theme.h1);
            
            const styled = generateStyledHtml(html, theme);
            document.getElementById('output').value = styled;
            
            // 验证
            const verify = document.getElementById('verify');
            verify.innerHTML = '<ul>' +
                '<li>包含 container: ' + (styled.includes('font-family') ? '✅' : '❌') + '</li>' +
                '<li>包含 h1 36px: ' + (styled.includes('font-size:36px') ? '✅' : '❌') + '</li>' +
                '<li>包含 h1 800: ' + (styled.includes('font-weight:800') ? '✅' : '❌') + '</li>' +
                '<li>包含 strong 荧光笔: ' + (styled.includes('#ffeb3b') ? '✅' : '❌') + '</li>' +
            '</ul>';
        }
    </script>
</body>
</html>
